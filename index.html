<!doctype html>
<html lang="vi">
<head><link rel="manifest" href="manifest.json">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üåø Tra c·ª©u ƒê√¥ng Y ‚Äî Ch·∫©n ƒêo√°n Nhanh g·ª£i √Ω nhanh G·ªëc B·ªánh </title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap&subset=vietnamese" rel="stylesheet">
  <script src="data.js"></script>
  <script src="chandoan.js"></script>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--accent:#0f58d6;--muted:#556172;--shadow:rgba(0,0,0,0.08)}
    *{box-sizing:border-box;font-family:"Inter", "Noto Sans", system-ui, sans-serif}
    body{margin:0;background:linear-gradient(180deg,#eef3ff 0%,var(--bg) 100%);color:#0b1220}
    .wrap{max-width:1200px;margin:18px auto;padding:16px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{font-size:28px}
    h1{font-size:20px;margin:0}
    .lead{color:var(--muted);font-size:13px;margin:0}
    .layout{display:flex;gap:16px}
    .sidebar{
  width:320px;
  background:#fff;
  padding:12px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,0.08);
  max-height:100vh;
  overflow-y:auto;
  overflow-x:hidden;
}

.children{
  max-height:0;
  overflow:hidden;
  transition:max-height .28s ease;
}

.children.open{
  max-height:2000px; /* ƒë·ªß l·ªõn cho m·ªçi tr∆∞·ªùng h·ª£p */
}
.content{flex:1;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 16px var(--shadow);min-height:60vh;overflow:auto}
    .sidebar, .content {
	-webkit-overflow-scrolling: touch;
	}
	.content {
	overflow: visible !important;
	}
	.searchbox {
	  width:100%;
	  padding:8px;
	  border-radius:8px;
	  border:1px solid #e6edf3;
	  font-size:14px; /* NgƒÉn tr√¨nh duy·ªát ph√≥ng to khi focus */
	}
	input, textarea {
	font-size:16px !important;
	}

 .muted{color:var(--muted)}
    /* Tree */
    .tree{margin:6px 0}
    .node{display:block;padding:8px;border-radius:8px;color:#0b1220;cursor:pointer;text-decoration:none;border:1px solid transparent}
    .node:hover{background:#eef6ff;border-color:rgba(37,99,235,0.12)}
    .folder{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .folder .label{display:flex;align-items:center;gap:6px;font-weight:600}
    .caret{transition:transform .18s ease;display:inline-block}
    .folder[aria-expanded="true"] .caret{transform:rotate(90deg)}
    .children { margin-left: 8px; border-left: 2px dashed #e9efff; padding-left: 8px; max-height: 0; overflow: hidden; transition: max-height 0.28s ease;}
	.child{display:block;padding:8px;border-radius:8px;border:1px solid transparent}
    .child:hover{background:#f5f9ff;border-color:#e6efff}
	.child { text-decoration: none;}
	.child a {text-decoration: none;}

    /* Cards */
    .subtypes{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
    .card-type{background:#fff;padding:12px;border-radius:10px;border:1px solid #eef4ff;min-height:120px;position:relative;box-shadow:0 6px 14px var(--shadow)}
    .card-type h4{margin:0;font-size:15px;color:#0b1220}
    .card-type p{margin:6px 0;color:var(--muted);font-size:13px}
    .chip{display:inline-block;background:#eef6ff;color:var(--accent);border:1px solid rgba(37,99,235,0.12);padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px}
    .secondary{background:#eef6ff;color:var(--accent);border:1px solid rgba(37,99,235,0.12);padding:8px 10px;border-radius:8px;cursor:pointer}
    button.btn{background:var(--accent);color:#fff;padding:8px 10px;border:0;border-radius:8px;cursor:pointer}
    /* Tooltip */
    .field-tooltip{position:fixed;z-index:99999;background:#0b1220;color:#fff;padding:8px 10px;border-radius:8px;font-size:13px;box-shadow:0 8px 24px rgba(2,6,23,0.4);pointer-events:none;opacity:0;transform:translateY(6px);transition:opacity .12s,transform .12s;max-width:min(520px,92vw);line-height:1.4}
    .field-tooltip.show{opacity:0.98;transform:translateY(0)}
    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:2000;padding:20px}
    .modal.open{display:flex}
    .modal-card{background:#fff;width:100%;max-width:780px;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.2);max-height:82vh;overflow:auto}
    .modal-card h3{margin:0 0 6px 0}
    .modal-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .close{background:#eee;border:0;padding:6px 10px;border-radius:8px;cursor:pointer}
    .list{margin:6px 0 0 0;padding-left:18px}
    @media (max-width:900px){ .layout{flex-direction:column} .sidebar{width:100%;height:auto} }
	
	#totalSubtypes {
  background: #eef6ff;
  border: 1px solid #dde7fb;
  border-radius: 8px;
  padding: 8px 12px;
  margin-bottom: 8px;
  color: #0f58d6;
  text-align: center;
}
.chip.clickable-disease:hover {
  background: #dfe9ff;
  color: #0f58d6;
  border-color: #bcd0ff;
  transition: 0.2s;
}
/* Tooltip n√¢ng c·∫•p v2 */
.btn-tooltip-wrap {
  position: relative;
  display: inline-block;
}

/* Tooltip box */
.btn-tooltip {
  position: absolute;
  top: 120%;  /* n·∫±m d∆∞·ªõi n√∫t */
  left: 50%;
  transform: translateX(-50%) scale(0.95);
  background: #f0f2f7; /* x√°m d·ªãu theo tone trang */
  color: #333;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 13px;
  line-height: 1.4;
  min-width: 250px;  /* chi·ªÅu ngang t·ªëi thi·ªÉu */
  max-width: 380px;  /* t·ªëi ƒëa ƒë·ªÉ kh√¥ng b·ªã qu√° d√†i ·ªü mobile */
  text-align: center;
  white-space: normal; /* t·ª± xu·ªëng d√≤ng n·∫øu d√†i */
  opacity: 0;
  pointer-events: none;
  box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  z-index: 10000;
  transition: opacity .25s ease, transform .25s ease;
}

/* Hi·ªáu ·ª©ng m·ªù d·∫ßn + n·ªïi */
.btn-tooltip.show {
  opacity: 1;
  transform: translateX(-50%) scale(1);
}

/* M≈©i t√™n ch·ªâ l√™n */
.btn-tooltip::after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent #f0f2f7 transparent;
}

.chip-kw { display:inline-block; background:#eef2ff; color:#0f58d6;
  border:1px solid rgba(37,99,235,0.12); border-radius:999px; padding:2px 8px;
  font-size:12px; margin-right:6px; }

.sym-tip {
  border-bottom: 1px dotted #888;
  cursor: help;
  position: relative;
}
.sym-tip:hover::after {
  content: attr(data-tip);
  position: absolute;
  left: 50%;
  bottom: 120%;
  transform: translateX(-50%);
  background: #f1f3f7;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 13px;
  white-space: nowrap;
  color: #333;
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
  z-index: 9999;
}

.icon-tag {
  display: inline-block;
  background: #f7f2e9;
  padding: 4px 6px;
  margin: 2px;
  border-radius: 6px;
  font-size: 14px;
  border: 1px solid #e0d7c5;
}
.icon-tag .hint {
  color: #725c3a;
  font-style: italic;
}
* {
  -webkit-print-color-adjust: exact !important;
  print-color-adjust: exact !important;
}
.list li {
  page-break-inside: avoid;
}
.modal-card {
  page-break-inside: avoid;
}
@media (max-width: 900px) {
  .layout {
    flex-direction: column;
  }
  .sidebar {
    width: 100% !important;
    overflow: visible !important;
    max-height: none !important;
    margin-bottom: 12px;
  }
  #dxPanel {
    margin-top: 12px !important;
    padding: 12px !important;
    font-size: 15px !important;
  }
  #dxBaGang .chip {
    font-size: 14px !important;
    padding: 4px 10px !important;
    margin-bottom: 6px;
  }
  #dxChatContent {
    font-size: 15px !important;
    line-height: 1.6;
  }
  /* Tooltip ƒëi·ªÅu ch·ªânh tr√™n mobile */
  #dxTip {
    max-width: 90vw !important;
    left: 8px !important;
    right: 8px !important;
    white-space: normal !important;
  }
}
/* ================================
   CH·∫∂N B√îI ƒêEN TRONG N·ªòI DUNG B√ÄI VI·∫æT
   ================================ */

.content, 
.content *:not(input):not(textarea):not(button),
#modalBody, 
#modalBody * {
  user-select: none !important;
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
}
  </style>
  

<style>
/* right-click toast */
#rcToast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:rgba(11,17,32,0.9);color:#fff;padding:8px 12px;border-radius:8px;font-size:13px;z-index:99999;opacity:0;transition:opacity .18s;pointer-events:none}
#rcToast.show{opacity:0.95}
</style>

</head>
<body>
<div id="rcToast" aria-hidden="true">‚ö†Ô∏è N·ªôi dung trang ƒë∆∞·ª£c b·∫£o v·ªá ‚Äî Vui l√≤ng s·ª≠ d·ª•ng t√≠nh nƒÉng In ho·∫∑c l∆∞u PDF.</div>
  <div class="wrap">
    <header>
      <div class="logo">üåø</div>
      <div>
        <h1>Tra c·ª©u ƒê√¥ng Y </h1>
        <p class="lead">L√£n √îng B√≠ Ph√°p - "K·ªâ Ni·ªám 300 NƒÉm Ng√†y Sinh H·∫£i Th∆∞·ª£ng L√£n √îng 27-12-1724 | 27-12-2025"</p>
      </div>
	   
    </header>
	<div class="group">
          <h3> </h3>
          <input id="globalSearch" class="searchbox" placeholder="üîç T√¨m Ki·∫øm (vd: B·ªï T√¢m, An Huy·∫øt, B√¨nh Kh√≠ ƒêan c√≥ th·ªÉ l·ª±a ch·ªçn t·ª´ kh√≥a g·ª£i √Ω gi√∫p ch·∫©n ƒëo√°n nhanh)">
		  <div id="dxKeywordSuggest" style="margin-top:6px; display:flex; flex-wrap:wrap; gap:6px;"></div>
          <p class="muted" style="font-size:12px;margin:6px 0 0"> </p>
        </div>
<script>
function slugify(str){
  return (str||'')
    .toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // b·ªè d·∫•u ti·∫øng Vi·ªát
    .replace(/[^a-z0-9]+/g,'-') // thay k√Ω t·ª± ƒë·∫∑c bi·ªát th√†nh -
    .replace(/^-+|-+$/g,'') // b·ªè d·∫•u - d∆∞ ·ªü ƒë·∫ßu/cu·ªëi
    .trim();
}
</script>

		
    <div class="layout">
	    <main class="content">
        <div id="mainIntro">
          <h1>Ch·ªçn b·ªánh ·ªü danh m·ª•c ho·∫∑c T√¨m ki·∫øm</h1>
		  </br>
		  <p class="lead"> </p>
          <p class="lead">1. Th·∫ª th·ªÉ b·ªánh hi·ªÉn th·ªã <b>tri·ªáu ch·ª©ng r√∫t g·ªçn</b>. Ch·∫°m/hover v√†o nh√£n <b>Ph√°p tr·ªã</b> ƒë·ªÉ xem nhanh. T√¨m ki·∫øm h·ªó tr·ª£ <b>b·ªè d·∫•u</b> v√† <b>so kh·ªõp g·∫ßn ƒë√∫ng</b>.T√≠nh nƒÉng in v√† l∆∞u l·∫°i <b> b√†i thu·ªëc </b> gi√∫p b·∫°n c√≥ th·ªÉ <b> s·ª≠ d·ª•ng b·∫•t k·ª≥ l√∫c n√†o</b>.</p>
		  </br>
          <p class="lead">2. Vui l√≤ng tham kh·∫£o √Ω ki·∫øn c·ªßa nh·ªØng <b> B√°c Sƒ© ƒê√¥ng Y Gi√†u kinh nghi·ªám </b> ho·∫∑c <b> C√°c c∆° s·ªü Kh√°m Ch·ªØa B·ªánh Uy T√≠n </b> tr∆∞·ªõc khi s·ª≠ d·ª•ng.</p>
		  </br>
		  <p class="lead">3. Vi·ªác chia s·∫ª c√°c b√†i thu·ªëc C·ªï Ph∆∞∆°ng Kinh ƒêi·ªÉn ho√†n to√†n <b> Mi·ªÖn Ph√≠ </b> nh·∫±m ph·ª•c v·ª• l·ª£i √≠ch chung c·ªßa C·ªông ƒê·ªìng ƒëam m√™ nghi√™n c·ª©u Y H·ªçc C·ªï Truy·ªÅn Vi·ªát Nam.</p>
		  </br>
		  <p class="lead">4. Ch√∫ng t√¥i kh√¥ng ch·ªãu <b> b·∫•t c·ª© tr√°ch nhi·ªám n√†o </b> khi ng∆∞·ªùi d√πng t·ª± √Ω √°p d·ª•ng </p>
		  </br>
		  <p class="lead">5. C·∫£m ∆°n c√°c b·∫°n ƒë√£ quan t√¢m. H√£y c√πng nhau chia s·∫ª v√† lan t·ªèa nh·ªØng gi√° tr·ªã t·ªët ƒë·∫πp c·ªßa YHCT ƒë·ªÉ n·ªÅn y h·ªçc c·ªï truy·ªÅn Vi·ªát Nam ng√†y c√†ng Ph√°t Tri·ªÉn. </p>
		   </br>
		  <p class="lead">6. Website:LanOngBiPhap.com  </p>
		  <p class="lead">TikTok | YouTube: L√£n √îng B√≠ Ph√°p </p>
		 
		</div>
        <div id="diseasePanel" style="display:none">
          <h2 id="diseaseTitle"></h2>
          <input id="filterSubtype" class="searchbox" placeholder="L·ªçc nhanh trong b·ªánh ƒëang xem (ti√™u ƒë·ªÅ/tri·ªáu ch·ª©ng/ph√°p tr·ªã)..." style="margin-top:10px"/>
          <div id="subtypes" class="subtypes"></div>
        </div>
      </main>
      <aside class="sidebar">
       
        <hr style="border:none;border-top:1px solid #edf2fb;margin:12px 0">
        <div class="group">
          <h3></h3>
          <div class="tree" id="tree">
            <!-- Tree will be rendered here -->
          </div> 
		   <div id="dxPanel" style="display:none; margin-top:10px; border:1px solid #ddd; padding:10px; border-radius:6px; background:#fafafa;">
		   <div id="dxBaGang" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
		   <div id="dxChat" style="display:none; margin-top:12px; padding:12px; border-radius:8px; background:#f7fff9; border:1px solid #a9e6c5;">
		   <div id="dxChatContent" style="line-height:1.6; font-size:16px;"></div>
		 </div>
        </div>
		</div>
		
      </aside>
	
    </div>
	  
  </div>
		

  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" id="modalCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">B√†i thu·ªëc</h3>
        <button class="close" id="modalClose" aria-label="ƒê√≥ng">ƒê√≥ng</button>
      </div>
      <div id="modalBody" style="margin-top:10px"></div>
      <div class="modal-actions">
        <button id="printThis" class="secondary">üñ® In b√†i n√†y</button>
        <button id="pdfThis" class="btn">üìÑ L∆∞u PDF b√†i n√†y</button>
      </div>
	  </br>
	  <p class="lead"><i>( * Th√¥ng tin ch·ªâ mang t√≠nh tham kh·∫£o. Li√™n H·ªá Th·∫ßy Thu·ªëc ƒê√¥ng Y Uy T√≠n Tr∆∞·ªõc Khi S·ª≠ D·ª•ng )</i></p>
		  
    </div>
  </div>

  <div id="tooltip" class="field-tooltip" role="tooltip"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script>
    // ====== D·ªÆ LI·ªÜU ======
    // B·ªï sung tr∆∞·ªùng "note" (L∆∞u √Ω).
	// üî• B·ªô nh·∫≠n di·ªán th·ªÉ b·ªánh (t·ª± ƒë·ªông th√™m icon)


function detectIcons(item){
  const text = ((item.symptom || "") + " " + (item.note || "")).toLowerCase();
  let out = "";
  patternTags.forEach(p=>{
    if(p.terms.some(t => text.includes(t))) out += " " + p.icon;
  });
  return out.trim();
}
function extractMarkers(title){
  const m = title.match(/\((.*?)\)/);
  if(!m) return [];
  return m[1].split(/,|;/).map(s => s.trim().toLowerCase()).filter(Boolean);
}
function annotateSymptoms(item){
  const markers = extractMarkers(item.title);
  let html = item.symptom || "";
  markers.forEach(m => {
    html = html.replace(new RegExp(m, "gi"),
      `<span class="sym-tip" data-tip="Tri·ªáu ch·ª©ng ch·ªß ch·ªët c·ªßa th·ªÉ b·ªánh">${m}</span>`);
  });
  return html;
}
	// Catalog theo nh√≥m -> b·ªánh
    const catalog = [
		  { group:"ü¶¥ C∆° X∆∞∆°ng Kh·ªõp ", diseases:[
			{ key:"daucovaigay", name:"üåø ƒêau c·ªï vai g√°y" },
			{ key:"Thoai_hoa_dot_song_Co", name:"üåø Tho√°i H√≥a ƒê·ªët S·ªëng C·ªï" },
			{ key:"daulung", name:"üåï ƒêau L∆∞ng" },
			{ key:"thoatvidiadem", name:"üèãÔ∏è‚Äç Tho√°t V·ªã ƒêƒ©a ƒê·ªám" },
			{ key:"dauthankinhtoa", name:"üò£‚Äç ƒêau th·∫ßn kinh t·ªça" },
			{ key:"Thoaihoakhopgoi", name:"ü¶µ‚Äç Tho√°i H√≥a Kh·ªõp G·ªëi" },
			{ key:"DauNhucXuongKHop", name:"ü¶∂‚Äç ƒêau Nh·ª©c X∆∞∆°ng Kh·ªõp" },
			{ key:"ChanTaySungDau", name:"üí™‚Äç Ch√¢n Tay S∆∞ng ƒêau" },
			{ key:"Tran_dich_khop_goi", name:"ü¶µ‚Äç Tr√†n D·ªãch Kh·ªõp G·ªëi" },
			{ key:"Vien_khop_khuu_tay", name:"üí¢‚Äç Vi√™m Kh·ªõp Khu·ª∑u Tay" },
			{ key:"DauCoTay", name:"‚úã ƒêau C·ªï Tay" },
			{ key:"loangxuong", name:"üí¢‚Äç Lo√£ng X∆∞∆°ng" },
			{ key:"NUY_chung", name:"üçµ B·∫°i Li·ªát Nuy Ch·ª©ng" },
			{ key:"Benh_Goutte", name:"‚öôÔ∏è B·ªánh G√∫t - Th·ªëng Phong" }
		  ]},
		  { group:"üíñ T√¢m th·∫ßn & üí≠ Th·∫ßn Kinh", diseases:[
			{ key:"matngu", name:"üí§ M·∫•t ng·ªß" },
			{ key:"dau_dau", name:"üò£ ƒêau ƒê·∫ßu" },
			{ key:"DauDauMat", name:"üò£ ƒêau V√πng ƒê·∫ßu M·∫∑t" },
			{ key:"TaibienMachmauNao", name:"üß† Tai Bi·∫øn M·∫°ch M√°u N√£o" },
			{ key:"Roiloantiendinh", name:"üí´ R·ªëi Lo·∫°n Ti·ªÅn ƒê√¨nh" },
			{ key:"DauThanKinh_Lien_Suon", name:"‚ö° ƒêau Th·∫ßn Kinh Li√™n S∆∞·ªùn" }
		  ]},
		    { group:"ü§ß H√¥ H·∫•p & üíñ Tim M·∫°ch", diseases:[
			{ key:"CamA", name:"üå¨Ô∏è C√∫m A - √în D·ªãch" },
			{ key:"CamCumNghetMui", name:"üå¨Ô∏è C·∫£m C√∫m, Ngh·∫πt M≈©i" },
			{ key:"ViemXoang_honghat", name:"üå¨Ô∏è Vi√™m Xoang H·ªçng H·∫°t" },
			{ key:"Phoitacnghen", name:"üç¨ Ho Kh√≥ Th·ªü" },
			{ key:"Viem_Amidan_1", name:"üç¨ Vi√™m Amidan " },
			{ key:"Viem_Phoi", name:"üò∑ Vi√™m Ph·ªïi" },
			{ key:"Viem_phe_quan", name:"üò∑ Vi√™m Ph·∫ø Qu·∫£n" },
			{ key:"TranDichMangPhoi", name:"üå¨Ô∏è Tr√†n D·ªãch M√†ng Ph·ªïi" },
			{ key:"Chung_Phe_Ung", name:"ü¶† √Åp Xe Ph·ªïi" },
			{ key:"DauThatNguc", name:"üò£Ô∏è ƒêau Th·∫Øt Ng·ª±c" },
			{ key:"RoiLoanNhipTim_TimDapNhanh", name:"üíñ Tim ƒê·∫≠p Nhanh, Lo·∫°n Nh·ªãp" },
			{ key:"Tim_Dap_Nhanh", name:"üíñ Tim ƒê·∫≠p Nhanh" },
			{ key:"Tim_Dap_Cham", name:"üíñ Tim ƒê·∫≠p Ch·∫≠m" },
			{ key:"Thap_Tim", name:"üíñ Th·∫•p kh·ªõp c·∫•p ‚Äì Th·∫•p tim" },
			{ key:"Suy_Tim", name:"ü•∂ Suy Tim" },
			{ key:"Thieu_Mau_Co_Tim", name:"üíñ Thi·∫øu M√°u C∆° Tim" }
		  ]},
		   { group:"üçµ Ti√™u H√≥a & üçù N·ªôi Ti·∫øt", diseases:[
			{ key:"TieuHoaKem", name:"üçµ Ti√™u H√≥a K√©m " },
			{ key:"Vi_khi_nghich", name:"üåø V·ªã Kh√≠ Ngh·ªãch " },
			{ key:"traonguocdaday", name:"üåø Tr√†o ng∆∞·ª£c d·∫° d√†y " },
			{ key:"daudaday", name:"üßÖ ƒêau D·∫° D√†y Co Th·∫Øt" },
			{ key:"HepMonVi", name:"üßÖ H·∫πp M√¥n V·ªã" },
			{ key:"Polyp_da_day", name:"üßÖ Polyp Ung Th∆∞ D·∫° D√†y" },
			{ key:"Hoi_chung_ruot_kich_thich", name:"üßÖ H·ªôi Ch·ª©ng Ru·ªôt K√≠ch Th√≠ch" },
			{ key:"Viem_Dai_Trang", name:"üòî Vi√™m ƒê·∫°i Tr√†ng" },
			{ key:"gannhiemmo", name:"üçÉ Gan Nhi·ªÖm M·ª°" },
			{ key:"MoMauCao", name:"üçÉ M·ª° M√°u Cao" },
			{ key:"Roi_loan_lipid_mau", name:"üåø R·ªëi Lo·∫°n Lipid M√°u" },
			{ key:"ViemGan", name:"üåø Vi√™m Gan" },
			{ key:"XoGanCoTruong", name:"üçÉ X∆° Gan C·ªï Tr∆∞·ªõng" },
		    { key:"Mengancao", name:"üçÉ Men Gan Cao" },
			{ key:"Polyp_tui_mat", name:"üçÉ Polyp T√∫i M·∫≠t" },
			{ key:"Hoang_Dan", name:"ü¶† Vi√™m Gan Si√™u Vi" },
			{ key:"ChuaViemGanTrungDoc", name:"üß´ Vi√™m Gan Tr√∫ng ƒê·ªôc" },
			{ key:"DauBung", name:"üçù ƒêau B·ª•ng" }
		  ]},
		  { group:"üí¶Ph·ª• Khoa & üöª Ti·∫øt Ni·ªáu", diseases:[
			{ key:"TienManKinh", name:"üî• Ti·ªÅn M√£n Kinh" },
			{ key:"HoiChungManKinh", name:"üî• H·ªôi Ch·ª©ng M√£n Kinh" },
			{ key:"SoiThan", name:"üåì S·ªèi Th·∫≠n" },
			{ key:"SuyThan", name:"üí¶ Suy Th·∫≠n" },
			{ key:"Viem_be_than_cap", name:"üí¶ Vi√™m B·ªÉ Th·∫≠n C·∫•p" },
			{ key:"SoiTietNieu", name:"üåë S·ªèi Ti·∫øt Ni·ªáu" },
			{ key:"DaiThaoDuong", name:"üçù ƒê√°i Th√°o ƒê∆∞·ªùng" },
			{ key:"ViemBangQuang", name:"üåû Vi√™m B√†ng Quang" },
			{ key:"Chung_Doi_Ha", name:"ü¶† Vi√™m T·ª≠ Cung" },
			{ key:"Kinh_Be", name:"üí¶ Kinh B·∫ø | V√¥ Kinh" },
			{ key:"Roi_loan_KN_ko_dung_ky", name:"üí´ R·ªëi Lo·∫°n Kinh Nguy·ªát" },
			{ key:"Kinh_nguyet_Sau_ky", name:"üí¶ Kinh Nguy·ªát Mu·ªôn" },
			{ key:"Kinh_nguyet_Truoc_ky", name:"üî• Kinh Nguy·ªát S·ªõm Tr∆∞·ªõc K·ª≥" },
			{ key:"Kinh_nguyet_It", name:"üí¶ Kinh Nguy·ªát √çT" },
		 	{ key:"Kinh_nguyet_tro_lai", name:"üí¶ Kinh Nguy·ªát Tr·ªü L·∫°i" },
			{ key:"Di_Tinh", name:"üí¶ Di Tinh | M·ªông Di - Ho·∫°t Di" }
		  ]},
		
		  { group:"ü©∫ Ngo·∫°i Khoa & Da Li·ªÖu", diseases:[
			{ key:"Viem_tac_dong_mach", name:"üå´Ô∏è Vi√™m T·∫Øc ƒê·ªông M·∫°ch" },
			{ key:"BenhSoi", name:"ü§î B·ªánh S·ªüi" },
			{ key:"MunTrungCaNamDa", name:"üå± M·ª•n Tr·ª©ng C√°, N√°m Da" },
			{ key:"TranThuong_BamTim", name:"üíñ Tr·∫•n Th∆∞∆°ng B·∫ßm T√≠m" },
		  	{ key:"XamDa", name:"üçµ X·∫°m Da" },
			{ key:"Bong", name:"üçÇ B·ªèng" },
			{ key:"Cham_da", name:"üß© Ch√†m"}
		  ]}, 
		  { group:"üß∏ Nhi Khoa (Pediatrics)", diseases:[
			{ key:"BenhTieuHoa_treem", name:"üåº B·ªánh Ti√™u H√≥a ·ªü Tr·∫ª Em" },
			{ key:"Dai_dam", name:"üí¶ ƒê√°i D·∫ßm" }
		  ]},
		  { group:"üï∏Ô∏è Ung Th∆∞ & üóø U B∆∞·ªõu", diseases:[
			{ key:"ungthumau", name:"ü©∏ Ung Th∆∞ M√°u" },
			{ key:"UngThutuyengiaptrang", name:"üç¨ Ung Th∆∞ Tuy·∫øn Gi√°p" },
			{ key:"UngThuThucQuan", name:"üç¨ Ung Th∆∞ Th·ª±c Qu·∫£n" },
			{ key:"UngThuDaDay", name:"üßÖ Ung Th∆∞ D·∫° D√†y" },
			{ key:"UngThuDaiTrang", name:"üßÖ Ung Th∆∞ ƒê·∫°i Tr√†ng" },
			{ key:"UngThuGan", name:"üçÉ Ung Th∆∞ Gan" },
			{ key:"UngThuBangQuang", name:"üí¶ Ung Th∆∞ B√†ng Quang" },
			{ key:"UngThu", name:"üå∏ Ung Th∆∞ Kh√°c" },
			{ key:"Uvu", name:"üå∏ U V√∫" },
			{ key:"Uxotienliettuyen", name:"üå∏ U X∆° Ti·ªÅn Li·ªát Tuy·∫øn" },
			{ key:"Uxo_Tu_Cung", name:"üå∏ U X∆° T·ª≠ Cung" },
			{ key:"UngThuhauMonTrucTrang", name:"üå∏ Ung Th∆∞ H·∫≠u M√¥n" },
			{ key:"UngThuTrucTrang", name:"üå∏ Ung Th∆∞ Tr·ª±c Tr√†ng" },
			{ key:"Uxo_Vu", name:"üå± U X∆° V√∫" },
			{ key:"UBuou", name:"üå± U B∆∞·ªõu" }
		  ]},
		    { group:"üå± N·ªôi Khoa & ‚öïÔ∏è Kh√°c", diseases:[
			{ key:"Sotxuathuyet", name:"üåø S·ªët Xu·∫•t Huy·∫øt" },
			{ key:"DauKhapMinh", name:"üå± ƒêau Kh·∫Øp M√¨nh" },
			{ key:"SayNang_TrungThu", name:"üåû Say N·∫Øng Tr√∫ng Th·ª≠" },
			{ key:"Toc_gay_rung", name:"üåû R·ª•ng T√≥c - Ban Th·ªëc" },
			{ key:"Tang_tieu_cau_vo_can", name:"ü©∏ TƒÉng ti·ªÉu c·∫ßu V√¥ CƒÉn" },
			{ key:"Tan_mau_bam_sinh_THALASEMMIA", name:"üíß Tan M√°u B·∫©m Sinh Thalasemmia" }
		  ]},
		    { group:"‚òØÔ∏è YHCT & ‚ú® Ch·ª©ng Tr·∫°ng", diseases:[
			{ key:"KhaiThau_Ho", name:"üå¨Ô∏è Kh√°i Th·∫•u - Ho" },
			{ key:"NUY_chung", name:"üå´Ô∏è Nuy T√Ω - B·∫°i Li·ªát" },
			{ key:"Chung_Tieu_khat", name:"üî• Ti√™u Kh√°t" },
			{ key:"Chung_Phe_Ung", name:"ü¶† Ph·∫ø Ung - √Åp Xe Ph·ªïi" },
			{ key:"Huyen_Vung", name:"üî• Huy·ªÖn V·ª±ng - HA Cao" },
			{ key:"Huyen_vung_HuyetApThap", name:"ü§ç Huy·ªÖn V·ª±ng - HA Th·∫•p" },
			{ key:"Huyen_vung_Chong_mat", name:"üí´ Huy·ªÖn V·ª±ng - Ch√≥ng M·∫∑t" },
			{ key:"Con_Dau_That_Nguc", name:"ü§ç C∆°n ƒêau Th·∫Øt Ng·ª±c" },
			{ key:"Hung_Ty", name:"üíñ Hung T√Ω | C∆°n ƒêau Tim" },
			{ key:"Vi_Quan_Thong", name:"üßÖ V·ªã Qu·∫£n Th·ªëng | ƒêau D·∫° D√†y" },
			{ key:"Vi_Quan_Thong_viem_da_day_man", name:"ü¶† V·ªã Qu·∫£n Th·ªëng | Vi√™m D·∫° D√†y M·∫°n" },
			{ key:"Vi_Ha_Thuy", name:"üíñ V·ªã H·∫° Th√πy | Sa D·∫° D√†y" },
			{ key:"Loet_da_day_ta_trang", name:"üíñ V·ªã Th·∫≠p Nh·ªã Ch·ªâ Tr√†ng H·ªôi Th∆∞∆°ng " },
			{ key:"Hoang_Dan", name:"ü¶† Ho√†ng ƒê·∫£n - Vi√™m Gan Si√™u Vi" },
			{ key:"That_Mien", name:"üí§ Th·∫•t Mi√™n - M·∫•t Ng·ªß" },
			{ key:"Chung_ty", name:"ü¶¥ Ch·ª©ng T√Ω - ƒêau Nh·ª©c X∆∞∆°ng Kh·ªõp" },
			{ key:"Chung_NHi_MInh", name:"üëÇ Nhƒ© Minh - Tai √ô" },
			{ key:"Chung_Doi_Ha", name:"üåÄ ƒê√°i H·∫° - Vi√™m C·ªï T·ª≠ Cung" },	
			{ key:"Co_Chuong_Xo_Gan", name:"üåø C·ªï Ch∆∞·ªõng - X∆° Gan" }	,
			{ key:"Chung_hu_lao", name:"üå¨ H∆∞ Lao - Lao Ph·ªïi" },
			{ key:"Chung_ha_tri", name:"üå∏ H·∫° Trƒ© - N·ªôi | Ngo·∫°i" },	
			{ key:"Chung_Mai_Hach_Khi", name:"üå∏ Mai H·∫°ch Kh√≠" },	
			{ key:"Chung_Truong_Ung", name:"üå´Ô∏è Ch·ª©ng Tr∆∞·ªùng Ung" },
			{ key:"Chung_Tich_Tu", name:"üåë Ch·ª©ng T√≠ch T·ª•" },
			{ key:"Nhiet_Lam", name:"ü¶† Nhi·ªát L√¢m | Vi√™m B·ªÉ Th·∫≠n C·∫•p" },
			{ key:"Duong_Thuy", name:"ü¶†  D∆∞∆°ng Th·ªßy | C·∫ßu Th·∫≠n Vi√™m C·∫•p" },
			{ key:"Phu_Thung", name:"ü¶† Ph√π Th≈©ng | C·∫ßu Th·∫≠n Vi√™m M·∫°n" },
			{ key:"Thach_lam", name:"üåë Th·∫°ch L√¢m | C∆°n ƒëau qu·∫∑n th·∫≠n" },
			{ key:"Lam_Chung", name:"üí¶ Vi√™m B√†ng Quang" },
			{ key:"Chung_bang_lau", name:"üå∏ BƒÉng L·∫≠u | Xu·∫•t Huy·∫øt T·ª≠ Cung" },
			{ key:"Chung_LongBe", name:"üí¶ Ch·ª©ng Long B·∫ø | B√≠ Ti·ªÉu" },
			{ key:"Cao_chi_huyet_chung", name:"ü©∏ Cholesterol M√°u Cao" },
			{ key:"Chung_Anh", name:"üç¨ Ch·ª©ng Anh | B∆∞·ªõu C·ªï" },
			{ key:"Lac_Cham", name:"ü§î L·∫°c Ch·∫©m | C·ªï V·∫πo" },
			{ key:"CanDuongHu", name:"üåø Can D∆∞∆°ng H∆∞" },
			{ key:"CanAmHu", name:"üçÉ Can √Çm H∆∞" },
			{ key:"Dien", name:"üåû ƒêi√™n - R·ªëi Lo·∫°n T√¢m Th·∫ßn" },
			{ key:"Cuong_Dien", name:"üßÖ Cu·ªìng | Hung Cu·ªìng" },
			{ key:"Dong_Kinh", name:"üåû Gi·∫£n Ch·ª©ng | ƒê·ªông Kinh" },
			{ key:"Bung_Dau", name:"üßÖ B·ª•ng ƒêau" }
		  ]}  
		];
// l∆∞u √Ω d·∫•u , ch·ªó n√†y -> b·ªánh

    // ====== T√åM KI·∫æM G·∫¶N ƒê√öNG TO√ÄN VƒÇN ======
    function norm(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }
    function levenshtein(a, b){
      a = norm(a); b = norm(b);
      const m = a.length, n = b.length;
      if(n===0) return m; if(m===0) return n;
      const dp = new Array(n+1).fill(0);
      for(let j=0;j<=n;j++) dp[j]=j;
      for(let i=1;i<=m;i++){
        let prev = dp[0]; dp[0]=i;
        for(let j=1;j<=n;j++){
          const tmp = dp[j];
          dp[j] = Math.min(
            dp[j] + 1,
            dp[j-1] + 1,
            prev + (a[i-1]===b[j-1] ? 0 : 1)
          );
          prev = tmp;
        }
      }
      return dp[n];
    }
    function fuzzyIncludes(text, query, tolerance=2){
      const A = norm(text); const B = norm(query).trim();
      if(!B) return true;
      if(A.includes(B)) return true;
      if(B.length<3) return false;
      const len = B.length;
      for(let i=0;i<=A.length-len;i++){
        const seg = A.substr(i, len);
        if(levenshtein(seg, B) <= tolerance) return true;
      }
      return false;
    }

    function diseaseName(key){
      for(const g of catalog){
        for(const d of g.diseases){
          if(d.key===key) return d.name;
        }
      }
      return key;
    }

    function allSubtypes(){
      const arr=[];
      for(const [dKey, list] of Object.entries(diseaseData)){
        list.forEach(item=> arr.push({ diseaseKey:dKey, diseaseName: diseaseName(dKey), ...item }));
      }
      return arr;
    }

    // ====== RENDER TREE ======
    const treeEl = document.getElementById('tree');
    function renderTree(){
      treeEl.innerHTML='';
      catalog.forEach((group, gi)=>{
		
		      // ====== T√çNH T·ªîNG S·ªê TH·ªÇ B·ªÜNH TO√ÄN H·ªÜ TH·ªêNG ======
      let totalSubtypes = 0;
      for (const key in diseaseData) {
        totalSubtypes += diseaseData[key].length;
      }

      // N·∫øu ch∆∞a c√≥ ph·∫ßn hi·ªÉn th·ªã t·ªïng, th√™m v√†o ƒë·∫ßu sidebar
      let totalDiv = document.getElementById('totalSubtypes');
      if (!totalDiv) {
        totalDiv = document.createElement('div');
        totalDiv.id = 'totalSubtypes';
        totalDiv.style.padding = '8px 0';
        totalDiv.style.fontSize = '14px';
        totalDiv.style.fontWeight = '600';
        totalDiv.innerHTML = `üìä T·ªïng s·ªë th·ªÉ b·ªánh YHCT: <b>${totalSubtypes}</b>`;
        treeEl.parentElement.insertBefore(totalDiv, treeEl);
      }

		
        const folder = document.createElement('div');
        folder.className='folder node';
        folder.setAttribute('aria-expanded','false');
        folder.innerHTML = `<div class="label"><span class="caret">‚ñ∂</span><span>${group.group}</span></div>`;
        const children = document.createElement('div');
        children.className='children';
        
		group.diseases.forEach(d=>{
  const a = document.createElement('a');
  a.className = 'child';
  const subCount = diseaseData[d.key] ? diseaseData[d.key].length : 0;
  a.textContent = `${d.name} (${subCount} th·ªÉ)`;
  a.href = 'javascript:void(0)';
  a.addEventListener('click', ()=> showDisease(d.key, d.name));
  children.appendChild(a);
});

        folder.addEventListener('click', (e)=>{
          // tr√°nh toggle khi click v√†o con
          if(e.target.closest('.child')) return;
          const isOpen = children.classList.toggle('open');
          folder.setAttribute('aria-expanded', isOpen ? 'true':'false');
        });
        treeEl.appendChild(folder);
        treeEl.appendChild(children);
      });
    }
    renderTree();
	
	

    // ====== UI CH√çNH ======
    const mainIntro = document.getElementById('mainIntro');
    const diseasePanel = document.getElementById('diseasePanel');
    const subtypesEl = document.getElementById('subtypes');
    const diseaseTitle = document.getElementById('diseaseTitle');
    const tooltip = document.getElementById('tooltip');
	function hideTooltip() {
	tooltip.classList.remove("show");
	tooltip.style.opacity = "0";
	}

    const modal = document.getElementById('modal');
    const modalCard = document.getElementById('modalCard');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');
    const printThis = document.getElementById('printThis');
    const pdfThis = document.getElementById('pdfThis');

    function showDisease(key, name){
      const list = diseaseData[key]||[];
      mainIntro.style.display='none';
      diseasePanel.style.display='block';
      const count = list.length;
      diseaseTitle.textContent = `${name} ‚Äî ${count} th·ªÉ b·ªánh`;
      renderSubtypes(list, key);
      // cu·ªôn l√™n ƒë·∫ßu khu n·ªôi dung
      diseasePanel.scrollIntoView({behavior:'smooth', block:'start'});
    }

    function truncate(str, n=120){
      if(!str) return '';
      return str.length>n ? str.slice(0,n).trim() + '‚Ä¶' : str;
    }
  function renderSubtypes(list, dKey = null) {
  subtypesEl.innerHTML = '';

  list.forEach(item => {
    const div = document.createElement('div');
    div.className = 'card-type';
    const diseaseKey = item.diseaseKey || dKey;
    const diseaseLabel = diseaseName(diseaseKey);

    // G·∫Øn name b·ªánh c√≥ th·ªÉ click ƒë∆∞·ª£c
    const chipClickable = diseaseKey
      ? `<span class="chip clickable-disease" data-key="${diseaseKey}" style="cursor:pointer;">${diseaseLabel}</span>`
      : '';

    div.innerHTML = `
      <h4>${item.title} ${chipClickable} </h4>
     <p class="small">${truncate(annotateSymptoms(item), 200)}</p>
      <label class="therapy-label" style="cursor:pointer;display:block;margin-top:6px">
        <input type="radio" name="subtype" hidden value="${item.therapy}" />
        <span>Xem <b>Ph√°p tr·ªã</b></span>
      </label>
	<div class="btn-tooltip-wrap">
	<button class="secondary">Xem b√†i thu·ªëc</button>
	<div class="btn-tooltip">${item.recipeTitle || item.title || 'Kh√¥ng r√µ'}</div>
	</div>
    `;

    // Tooltip
    const lbl = div.querySelector('.therapy-label');
    const radio = div.querySelector('input');
    lbl.addEventListener('mouseenter', e => showTooltip(e, radio.value));
    lbl.addEventListener('mousemove', e => showTooltip(e, radio.value));
    lbl.addEventListener('mouseleave', hideTooltip);
    lbl.addEventListener('click', e => {
      showTooltip(e, radio.value, true);
      setTimeout(hideTooltip, 3000);
    });

    // Khi click v√†o chip (t√™n b·ªánh) ‚Üí hi·ªÉn th·ªã to√†n b·ªô th·ªÉ b·ªánh c·ªßa key
    const chip = div.querySelector('.clickable-disease');
    if (chip) {
      chip.addEventListener('click', () => {
        const key = chip.dataset.key;
        if (diseaseData[key]) {
          diseaseTitle.textContent = `${diseaseName(key)} ‚Äî ${diseaseData[key].length} th·ªÉ b·ªánh`;
          renderSubtypes(diseaseData[key], key);
        } else {
          alert('‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu cho b·ªánh n√†y.');
        }
      });
    }

    // Khi click v√†o n√∫t xem b√†i thu·ªëc
    const btn = div.querySelector('button');
    btn.addEventListener('click', () => openRecipe(item));

    subtypesEl.appendChild(div);
  });
}

function showTooltip(e, text, forceBelow=false){
  if(!tooltip) return;

  tooltip.textContent = text;
  tooltip.style.display = "block";
  tooltip.style.opacity = "1";

  let x = e.clientX + 12;
  let y = e.clientY - 28;
  if(forceBelow || y < 60){ y = e.clientY + 18; }

  tooltip.style.left = x + "px";
  tooltip.style.top  = y + "px";

  tooltip.classList.add("show");
}

function hideTooltip(){
  if(!tooltip) return;
  tooltip.classList.remove("show");
  tooltip.style.opacity = "0";
  tooltip.style.display = "none";   // ‚úÖ Quan tr·ªçng: Cho ph√©p hover l·∫°i m∆∞·ª£t m√†
}

    function openRecipe(item){
      const recipeLines = (item.recipe||'').split(/\n+/).map(s=>s.trim()).filter(Boolean);
      const listHtml = recipeLines.map(s=>`<li>${s}</li>`).join('');
	// Ti√™u ƒë·ªÅ		modalTitle.textContent = detectIcons(item) + " " + item.title;
					modalTitle.textContent = item.title;

      modalBody.innerHTML = `
        <p><b>Th·ªÉ b·ªánh:</b> ${item.title}</p>
        <p><b>Tri·ªáu ch·ª©ng:</b> ${item.symptom}</p>
        <p><b>Ph√°p tr·ªã:</b> ${item.therapy}</p>
        <p><b>T√™n b√†i thu·ªëc:</b> ${item.recipeTitle||'‚Äî'}</p>
        <p><b>C√¥ng th·ª©c:</b></p>
        <ul class="list">${listHtml || '<li>ƒêang c·∫≠p nh·∫≠t</li>'}</ul>
        <p><b>L∆∞u √Ω:</b> ${item.note || '‚Äî'}</p>
      `;
      modal.classList.add('open');
      printThis.onclick = ()=> printElement(modalCard);
      pdfThis.onclick = ()=> savePdfElement(modalCard, `Bai-thuoc-${slugify(item.title)}.pdf`);
	  document.getElementById("modalTags").textContent = detectIcons(item);
    }

   function printElement(el){
	  const html = `
	  <html>
	  <head>
		<title>L√£n √îng B√≠ Ph√°p - lanongbiphap.com</title>
		<meta charset="utf-8">
		<style>
		  body{font-family:Inter,Arial,sans-serif;padding:16px;line-height:1.6;}
		  h3{margin-bottom:8px;}
		  ul{padding-left:18px;}
		  li{margin-bottom:4px;}
		</style>
	  </head>
	  <body>${el.innerHTML}</body>
	  </html>`;

	  const w = window.open('', '_blank');
	  w.document.write(html);
	  w.document.close();
	  w.focus();
	  w.print();
	}


    function savePdfElement(el, filename='Bai-thuoc.pdf'){
	const prevMaxHeight = el.style.maxHeight;
	const prevOverflow  = el.style.overflow;

	// M·ªü r·ªông modal ƒë·ªÉ html2pdf ƒë·ªçc ƒë·ªß n·ªôi dung
	el.style.maxHeight = 'none';
	el.style.overflow = 'visible';

	const opt = {
	margin: 10,
	filename,
	image: { type: 'jpeg', quality: 0.98 },
	html2canvas: { 
	  scale: 2,
	  useCORS: true
	},
	jsPDF: { unit: 'mm', format: 'a4', orientation:'portrait' },
	pagebreak: { mode: ['avoid-all','css','legacy'] }
	};

	html2pdf().from(el).set(opt).save().then(()=>{
	// Kh√¥i ph·ª•c modal
	el.style.maxHeight = prevMaxHeight;
	el.style.overflow = prevOverflow;
	});
	}


    modalClose.addEventListener('click',()=> modal.classList.remove('open'));
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') modal.classList.remove('open'); });
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('open'); });

    // L·ªçc nhanh trong danh s√°ch ƒëang xem
    document.getElementById('filterSubtype').addEventListener('input',function(){
      const q = this.value.toLowerCase();
      const list = Array.from(subtypesEl.querySelectorAll('.card-type'));
      list.forEach(card=>{
        const text=card.innerText.toLowerCase();
        card.style.display = text.includes(q)?'block':'none';
      });
    });

</script>
<script>
// gentle right-click prevention with toast
(function(){
  function showRcToast() {
    const t = document.getElementById('rcToast');
    if (!t) return;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 1800);
  }

  document.addEventListener('contextmenu', function(e) {
    // Cho ph√©p click ph·∫£i trong input, textarea, ho·∫∑c v√πng c√≥ th·ªÉ ch·ªânh s·ª≠a
    const tag = e.target && e.target.tagName && e.target.tagName.toLowerCase();
    if (tag === 'input' || tag === 'textarea' || e.target.isContentEditable) return;

    // Ch·∫∑n menu chu·ªôt ph·∫£i
    e.preventDefault();
    showRcToast();
  });
})();
</script>

<!-- ‚úÖ FAST SEARCH: Web Worker + Fuse.js (gi·ªØ nguy√™n UI, kh√¥ng kh√≥a giao di·ªán) -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
(function(){
  // 0) Clone input ƒë·ªÉ g·ª° to√†n b·ªô listener c≈© (tr√°nh xung ƒë·ªôt logic c≈©)
  function replaceWithClone(el){
    if(!el) return null;
    const c = el.cloneNode(true);
    el.parentNode.replaceChild(c, el);
    return c;
  }
  const inputSide0 = document.getElementById('globalSearch');   // ƒë√£ c√≥ trong v8
  const inputTop0  = document.getElementById('globalSearchTop'); // n·∫øu c√≥
  const inputSide  = replaceWithClone(inputSide0) || inputSide0;
  const inputTop   = replaceWithClone(inputTop0)  || inputTop0;

  // 1) Loader nh·ªè ·ªü g√≥c ƒë·ªÉ b√°o tr·∫°ng th√°i
  const loader = document.createElement('div');
  loader.id = 'fastLoader';
  loader.style.cssText = 'position:fixed;bottom:12px;right:12px;background:#0f58d6;color:#fff;padding:8px 14px;border-radius:8px;font-size:13px;z-index:9999;display:none;';
  loader.textContent = 'ƒêang kh·ªüi t·∫°o t√¨m ki·∫øm...';
  document.body.appendChild(loader);
  function hideFastLoader() {
  const lf = document.getElementById("fastLoader");
  if (lf) lf.style.display = "none";
	}
  // 2) Worker code: index + search trong lu·ªìng ri√™ng
  const workerCode = () => {
    let fuse;
    self.onmessage = (e) => {
      const { type, payload, q } = e.data || {};
      if(type === 'init'){
        importScripts('https://cdn.jsdelivr.net/npm/fuse.js@6.6.2');
        fuse = new Fuse(payload || [], {
          keys: ['title','symptom','therapy','recipeTitle','recipe','note'],
          threshold: 0.35,
          minMatchCharLength: 2,
          ignoreLocation: true,
          includeScore: false
        });
        self.postMessage({ type:'ready' });
      } else if(type === 'search'){
        if(!fuse || !q || !q.trim()){ self.postMessage({type:'results', results:[]}); return; }
        // Gi·ªõi h·∫°n s·ªë k·∫øt qu·∫£ render ƒë·ªÉ tr√°nh DOM qu√° l·ªõn
        const results = fuse.search(q).slice(0, 120).map(r => r.item);
        self.postMessage({ type:'results', results });
      }
    };
  };
  const blob  = new Blob(['('+workerCode.toString()+')()'], {type:'application/javascript'});
  const worker = new Worker(URL.createObjectURL(blob));

  // 3) Gom d·ªØ li·ªáu t·ª´ diseaseData / allSubtypes
  function buildData(){
    try {
      if(typeof window.allSubtypes === 'function'){
        const list = window.allSubtypes();
        if(Array.isArray(list) && list.length) return list;
      }
    } catch(_) {}
    const arr = [];
    if (typeof window.diseaseData === 'object'){
      for (const [key, list] of Object.entries(window.diseaseData)) {
        if (Array.isArray(list)) list.forEach(it => arr.push({ diseaseKey:key, ...it }));
      }
    }
    return arr;
  }
  const data = buildData();
  loader.style.display = 'block';
  worker.postMessage({ type:'init', payload: data });

  // 4) Nh·∫≠n k·∫øt qu·∫£, render theo UI g·ªëc
  let ready = false;
  worker.onmessage = (e) => {
    const { type, results } = e.data || {};
    if(type === 'ready'){
      ready = true;
      loader.textContent = 'ƒê√£ s·∫µn s√†ng t√¨m ki·∫øm üîç';
      setTimeout(()=> loader.style.display='none', 1000);
      return;
    }
    if(type === 'results'){
      loader.style.display = 'none';
      const mainIntro    = document.getElementById('mainIntro');     // ƒë√£ c√≥
      const diseasePanel = document.getElementById('diseasePanel');  // ƒë√£ c√≥
      if(mainIntro && diseasePanel){
        mainIntro.style.display    = results.length ? 'none'  : 'block';
        diseasePanel.style.display = results.length ? 'block' : 'none';
      }
      const title = document.getElementById('diseaseTitle');
      if(title) title.textContent = results.length ? `K·∫øt qu·∫£ t√¨m ki·∫øm (${results.length})` : '';

      if (typeof window.renderSubtypes === 'function' && document.getElementById('subtypes')){
        window.renderSubtypes(results, null);
      } else {
        // fallback t·∫°m n·∫øu trang thi·∫øu h√†m render
        let box = document.getElementById('fastResults');
        if(!box){
          box = document.createElement('div');
          box.id = 'fastResults';
          box.style.cssText = 'background:#fff;border:1px solid #eef4ff;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px;border-radius:10px;margin:10px 0;';
          (document.querySelector('.content')||document.body).prepend(box);
        }
        box.innerHTML = results.slice(0,50).map(it => `
          <div style="padding:8px 0;border-bottom:1px solid #f1f4ff">
            <b>${it.title||''}</b>
            <div style="color:#556;margin-top:6px">${(it.symptom||'').slice(0,160)}</div>
          </div>`).join('') || '<i>Kh√¥ng t√¨m th·∫•y.</i>';
      }
    }
  };

  // 5) Debounce & g·∫Øn event
  function debounce(fn, t){ let x; return (...a)=>{ clearTimeout(x); x=setTimeout(()=>fn.apply(null,a), t); }; }
  const doSearch = debounce((q)=>{
    if(!ready) return;
    if(!q || !q.trim()){
      // clear UI ‚Üí v·ªÅ trang ch√†o
      const mainIntro    = document.getElementById('mainIntro');
      const diseasePanel = document.getElementById('diseasePanel');
      if(mainIntro && diseasePanel){ mainIntro.style.display='block'; diseasePanel.style.display='none'; }
      return;
    }
    loader.style.display='block'; loader.textContent='ƒêang t√¨m...';
    worker.postMessage({ type:'search', q:q });
  }, 300);

  [inputSide, inputTop].forEach(inp=>{
    if(!inp) return;
    inp.addEventListener('input', e => doSearch(e.target.value || ''));
    inp.addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); doSearch(e.target.value||''); }});
  });
})();
</script>
<script>
(function(){
  document.addEventListener("mouseover", function(e){
    const wrap = e.target.closest(".btn-tooltip-wrap");
    if(!wrap) return;
    const tooltip = wrap.querySelector(".btn-tooltip");
    if(!tooltip) return;

    // ch·ªâ hi·ªán khi hover, kh√¥ng khi click
    if(!wrap.classList.contains("tooltip-disabled")) {
      tooltip.classList.add("show");
      clearTimeout(tooltip._hideTimer);
      tooltip._hideTimer = setTimeout(() => {
        tooltip.classList.remove("show");
      }, 3500);
    }
  });

  document.addEventListener("mouseout", function(e){
    const wrap = e.target.closest(".btn-tooltip-wrap");
    if(!wrap) return;
    const tooltip = wrap.querySelector(".btn-tooltip");
    if(tooltip){
      tooltip.classList.remove("show");
    }
  });

  // ‚úÖ Khi click ‚Üí t·∫Øt tooltip v√† KH√îNG cho tooltip hi·ªán l·∫°i n·ªØa
  document.addEventListener("click", function(e){
    const wrap = e.target.closest(".btn-tooltip-wrap");
    if(!wrap) return;
    const tooltip = wrap.querySelector(".btn-tooltip");
    if(!tooltip) return;

    tooltip.classList.remove("show");
    wrap.classList.add("tooltip-disabled"); // kh√≥a tooltip kh√¥ng b·∫≠t l·∫°i
  });
})();
</script>
<script>
// === HI·ªÇN TH·ªä K·∫æT QU·∫¢ B√ÅT C∆Ø∆†NG ===
function renderDiagnosisUI(items){
  const panel = document.getElementById('dxPanel');
  const chips = document.getElementById('dxBaGang');
  const chat  = document.getElementById('dxChat');
  const chatC = document.getElementById('dxChatContent');

  if (!panel || !chips || !chat || !chatC) return;

  if (!items || !items.length){
    panel.style.display = 'none';
    chat.style.display  = 'none';
    chips.innerHTML     = '';
    chatC.innerHTML     = '';
    return;
  }

  panel.style.display = 'block';
  chat.style.display  = 'block';

  chips.innerHTML = items.map(it => {
    const ds = window.DIAGNOSE_DATA.find(d => d.label === it.label);
    const tips = ds && ds.terms ? ds.terms.join(", ") : "";
    return `
      <span class="chip dx-chip" data-tip="${tips}">
        ${it.icon} ${it.label}
      </span>
    `;
  }).join('');

  const top = items[0];
  chatC.innerHTML =
    `<b>${top.icon} ${top.label}</b> (ƒëi·ªÉm kh·ªõp: ${top.score})<br>
     <small>G·ª£i √Ω: ƒê·ªëi chi·∫øu tri·ªáu ch·ª©ng ƒë·ªÉ ch·ªçn th·ªÉ b·ªánh ph√π h·ª£p.</small>`;
}

// Tooltip cho chip + auto fit mobile
document.addEventListener("mousemove", function(e){
  const chip = e.target.closest(".dx-chip");
  let t = document.getElementById("dxTip");

  if(!t){
    t = document.createElement("div");
    t.id = "dxTip";
    t.style.cssText = `
      position:fixed; z-index:99999; background:#0b1220; color:#fff;
      padding:8px 10px; border-radius:8px; font-size:14px;
      box-shadow:0 8px 24px rgba(0,0,0,0.25);
      max-width:280px; display:none; line-height:1.5;
    `;
    document.body.appendChild(t);
  }

  if(chip){
    t.innerHTML = chip.dataset.tip || '';
    t.style.display = "block";
    t.style.left = (e.clientX + 14) + "px";
    t.style.top  = (e.clientY + 14) + "px";
  } else {
    t.style.display = "none";
  }
});


// === G·∫ÆN S·ª∞ KI·ªÜN SAU KHI INPUT B·ªä CLONE B·ªûI FAST SEARCH ===
(function restoreDxBinding(){
  function bind(){
    const input = document.getElementById('globalSearch');
    if(!input || typeof diagnoseFromKeywords !== 'function') return;
    input.addEventListener('input', e => {
      const q = e.target.value.trim();
      const r = diagnoseFromKeywords(q);
      renderDiagnosisUI(r);
    });
  }
  setTimeout(bind, 600); // ƒë·ª£i Fast Search clone xong input
})();
</script>
<script>
(function(){
  const version = '2025-11-NEW-25-14h50'; // ƒë·ªïi gi√° tr·ªã n√†y m·ªói l·∫ßn update
  const saved = localStorage.getIte('app_version');
  if(saved !== version){
    localStorage.setItem('app_version', version);
    console.log("üî• Phi√™n b·∫£n m·ªõi ‚Üí t·ª± ƒë·ªông reload cache");
    location.reload(true);
  }
})();
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(reg => reg.unregister());
  });
}
</script>

<script>
(function(){
  const input = document.getElementById('globalSearch');
  const box   = document.getElementById('dxKeywordSuggest');
  if(!input || !box || !window.DIAGNOSE_DATA) return;

  let selected = [];
  let currentGroup = null;

  const norm = s => (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");

  function findGroup(term){
    const t = norm(term);
    return DIAGNOSE_DATA.find(g => (g.terms||[]).some(x => norm(x).includes(t)));
  }

  function suggestPrimary(q){
    const out = new Set();
    q = norm(q);
    DIAGNOSE_DATA.forEach(g => g.terms.forEach(t => { if(norm(t).includes(q)) out.add(t); }));
    return Array.from(out).slice(0, 20);
  }

  function suggestNext(){
    let out = currentGroup 
        ? currentGroup.terms.filter(t => !selected.includes(t))
        : [];

    const others = DIAGNOSE_DATA.filter(g => g !== currentGroup);
    const rand = others[Math.floor(Math.random()*others.length)];
    out = out.concat(rand.terms.filter(t => !selected.includes(t)));

    return out.slice(0, 20);
  }

  function render(list){
    if(!list.length){ box.innerHTML=""; return; }
    box.innerHTML = list.map(t => `<span class="chip dx-kw" data-k="${t}">${t}</span>`).join("");
  }

 
// ‚úÖ CLICK CH·ªåN T·ª™ KH√ìA
box.addEventListener("click", e=>{
  const el = e.target.closest(".dx-kw");
  if(!el) return;
  const term = el.dataset.k;

  if(!selected.includes(term)) selected.push(term);
  currentGroup = findGroup(term) || currentGroup;

  input.value = selected.join(", ") + ", ";

  // ‚úÖ G·ªçi t√¨m ki·∫øm ngay l·∫≠p t·ª©c
  input.dispatchEvent(new Event("input", { bubbles:true }));

  render(suggestNext());

  // ‚úÖ GI·ªÆ CON TR·ªé CHO L·∫¶N G√ï TI·∫æP
  input.focus();
});

// ‚úÖ BACKSPACE/DELETE th√¥ng minh
input.addEventListener("keydown", e=>{
  if(e.key !== "Backspace" && e.key !== "Delete") return;

  const raw = input.value;

  const selStart = input.selectionStart;
  const selEnd   = input.selectionEnd;
  const isSelecting = selStart !== selEnd;

  // 1) ‚úÖ N·∫øu b√¥i ƒëen to√†n b·ªô ‚Üí Reset t·∫•t c·∫£
  if(selStart === 0 && selEnd === raw.length){
    e.preventDefault();
    selected = [];
    currentGroup = null;
    input.value = "";
    box.innerHTML = "";
    return;
  }

  // 2) ‚úÖ N·∫øu b√¥i ƒëen m·ªôt ƒëo·∫°n ‚Üí x√≥a ƒë√∫ng c·ª•m ƒë√≥
  if(isSelecting){
    e.preventDefault();

    // T√°ch input th√†nh c√°c c·ª•m t·ª´
    const parts = raw.split(",").map(s=>s.trim()).filter(Boolean);

    // T√¨m c·ª•m n√†o ch·ª©a ƒëo·∫°n b√¥i ƒëen
    const before = raw.slice(0, selStart);
    const index = before.split(",").filter(s=>s.trim()).length - 1;

    if(index >= 0){
      parts.splice(index, 1);   // x√≥a c·ª•m ƒë√≥
      selected.splice(index, 1); // x√≥a trong m·∫£ng logic
    }

    // C·∫≠p nh·∫≠t l·∫°i nh√≥m
    currentGroup = selected.length
      ? findGroup(selected[selected.length-1])
      : null;

    // C·∫≠p nh·∫≠t l·∫°i giao di·ªán input
    input.value = selected.length ? selected.join(", ") + ", " : "";
    input.dispatchEvent(new Event("input", { bubbles:true }));

    render(selected.length ? suggestNext() : []);
    return;
  }

  // 3) ‚úÖ N·∫øu kh√¥ng b√¥i ƒëen ‚Üí x·ª≠ l√Ω x√≥a c·ª•m cu·ªëi
  if(raw.endsWith(", ") || raw.endsWith(",")){
    e.preventDefault();
    selected.pop();
    currentGroup = selected.length ? findGroup(selected[selected.length-1]) : null;
    input.value = selected.length ? selected.join(", ") + ", " : "";
    input.dispatchEvent(new Event("input", { bubbles:true }));
    render(selected.length ? suggestNext() : []);
    return;
  }

  // 4) ‚úÖ N·∫øu ch·ªâ ƒëang g√µ ‚Üí cho x√≥a k√Ω t·ª± b√¨nh th∆∞·ªùng, nh∆∞ng theo d√µi
  setTimeout(()=>{
    const val = input.value.trim();
    if(!val){
      selected = [];
      currentGroup = null;
      box.innerHTML = "";
      return;
    }
    const parts2 = val.split(",").map(s=>s.trim()).filter(Boolean);
    const last = parts2[parts2.length - 1] || "";
    render(suggestPrimary(last));
  },0);

});



  // ‚úÖ G√ï B√ÄN PH√çM (Realtime Suggest + Auto Search)
  input.addEventListener("input", e=>{
    const raw = input.value;

    // X√ìA H·∫æT ‚Üí RESET
    if(!raw.trim()){
      selected = [];
      currentGroup = null;
      box.innerHTML = "";
      return;
    }

    const parts = raw.split(",").map(s=>s.trim()).filter(Boolean);
    const last = parts[parts.length - 1];

    // Lu√¥n g·ª£i √Ω d·ª±a theo t·ª´ ƒëang g√µ
    render(suggestPrimary(last));

    // ‚úÖ N·∫øu ng∆∞·ªùi d√πng g√µ d·∫•u ph·∫©y ‚Üí x√°c nh·∫≠n t·ª´ kh√≥a & T·ª∞ T√åM NGAY
    if(raw.endsWith(",")){
      if(last && !selected.includes(last)){
        selected.push(last);
        currentGroup = findGroup(last) || currentGroup;
      }

      input.value = selected.join(", ") + ", ";

      // ‚úÖ T·ª± ƒë·ªông ch·∫°y t√¨m ki·∫øm ngay
      input.dispatchEvent(new Event("input", { bubbles:true }));

      render(suggestNext());
    }
  });

})();
</script>

</body>
</html>